#textdomain wesnoth-h2tt

    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                        FENCE HINT
    #######################################################################################################################################################
    # give the player a way to bypass the 3 opening scenarios if they want to
    # this is also a nice little reward for exploration/interaction
    [event]
        name=prestart
        {FILTER_CONDITION( {VARIABLE_CONDITIONAL bm_found_fence not_equals yes} )}
        
        {NAMED_UNIT 2 "Elvish Civilian" 1 59 fence_wanderer _"Wanderer" ()} {FACING sw} {GENDER male}
        
        [event]
            name=moveto
            first_time_only=no
            {FILTER( {FILTER_ADJACENT id=fence_wanderer} )}
            [message]
                speaker=fence_wanderer
                message= _ "Hello, young prince. A lovely day for wandering, isn’t it?"
            [/message]
            [message]
                speaker=fence_wanderer
                message= _ "I once wandered my way past a loose board set in the fence between the wood and the bay. I’ve forgetten exactly where, but I’m sure you could find it if you wandered back and forth enough times."
            [/message]
        [/event]
        [event]
            name=enter hex {FILTER x,y=22,48}
            [event]
                name=enter hex {FILTER x,y=22,48}
                [event]
                    name=enter hex {FILTER x,y=22,48}
                    [event]
                        name=enter hex {FILTER x,y=22,48}
                        [message]
                            speaker=Konrad
                            message= _ "Hey, look! There’s a loose board in the fence here."
                        [/message]
                        {SOUND axe.ogg}
                        {MODIFY_TERRAIN Re 23 48}
                        [cancel_action][/cancel_action]
                        {VARIABLE bm_found_fence yes}
                    [/event]
                [/event]
            [/event]
        [/event]
    [/event]
    [event]
        name=prestart
        {FILTER_CONDITION( {VARIABLE_CONDITIONAL bm_found_fence equals yes} )}
        {MODIFY_TERRAIN Re 23 48}
    [/event]
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                  S01 - THE ELVES BESIEGED
    #######################################################################################################################################################
    [event]
        name=prestart
        {FILTER_CONDITION( {LUA(<<return wesnoth.current.turn==1>>)} )}
        
        {VARIABLE status_s01 completed}
        {RECALL_XY Konrad 15 56}
        {TELEPORT_UNIT id=Konrad 10 52} {FIRE_EVENT_UNIT enter_hex id=Konrad}
        {TELEPORT_UNIT id=Konrad 17 54} {FIRE_EVENT_UNIT enter_hex id=Konrad}
        {TELEPORT_UNIT id=Konrad  9 56} {FIRE_EVENT_UNIT enter_hex id=Konrad}
        {PUT_TO_RECALL_LIST id=Konrad}
        {SCROLL_TO 15 56}
        
        [event]
            name=start
            {DELAY 1500}
            {RECALL_XY Konrad 15 56}
            {DELAY 500}
            {MOVE_UNIT id=Konrad 10 56}
            {MODIFY_UNIT id=Konrad facing ne}
            {DELAY 500}
            {MOVE_UNDER_KONRAD(  {UNSTORE_NPC Delfador x,y=10,56 side=1} {GIVE_OBJECT_TO id=Delfador id=dont_levitate} {MOVE_UNIT id=Delfador 11 56}  )}
            
            {MODIFY_UNIT id=Delfador facing sw}
            {DELAY 500}
            [message]
                speaker,image=Delfador
                message= _ "Well done, Konrad! Fresh air at last; we have escaped the smoke and fire."
            [/message]
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "But the rest of the elves have not; they’re still trapped in the battle! And look — even our friends at Blackwater Port are being attacked! I thought you said this part of the world was safe from Wesnoth?"
            [/message]
            [message]
                speaker=Delfador
                message= _ "With the support of Elensefar and the Aethenwood, it is true that the western reaches have suffered less of the dark queen’s tyrrany than have the rest of the realm. But now even this has come to an end; that woman’s mad lust for control truly knows no bounds!"
            [/message]
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "Then we must do something! Delfador, we can’t keep running away while others get hurt."
            [/message]
            [message]
                speaker=Delfador
                message= _ "You’re quite right, Konrad. I’m afraid there is nothing for it; we shall have to start our campaign against Asheviere sooner than planned. I had hoped to wait until you were older... Hmph, I remember my own master telling me that once."
            [/message]
            [message]
                speaker=Konrad
                message= _ "Don’t worry Delfador, I’m ready. Now come on, let’s go save the kingdom!"
            [/message]
            {MOVE_UNDER_KONRAD(
                {MOVE_UNIT id=Delfador 10 56}
                {MODIFY_UNIT id=Delfador side 1}
                {REMOVE_OBJECT dont_levitate id=Delfador}
                {PUT_TO_RECALL_LIST id=Delfador}
            )}
            
            [event]
                name=select
                {FILTER id=Konrad}
                [message]
                    speaker,caption,image=narrator,_"Delfador",portraits/delfador.webp
                    message= _ "Behold the great continent, young prince — a place of many possibilities. Where shall we go? What shall we do? The wide world beckons!"
                [/message]
                [display_overworld_tutorial]
                [/display_overworld_tutorial]
            [/event]
        [/event]
    [/event]
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                S02 - FLIGHT OF THE ELVES
    #######################################################################################################################################################
    [event]
        name=prestart
        {SET_LABEL 13 55 _"Aethenwood"}
        [if] {LUA(<<return wesnoth.current.turn==3>>)} 
             {VARIABLE_CONDITIONAL status_s02 not_equals in_progress} {THEN(
            {VARIABLE status_s02 failed}
        )} [/if]
    [/event]
    [event]
        name=prestart
        [if] {LUA(<<return wesnoth.current.turn==1>>)} {THEN( {VARIABLE s02_title _"Flight of the Elves - 2 season remaining"} )} [/if]
        [if] {LUA(<<return wesnoth.current.turn==2>>)} {THEN( {VARIABLE s02_title _"Flight of the Elves - 1 season remaining (last chance!)"}  )} [/if]
        # we don't play any approach message on turn 1. Reset approached_s02 so that we might play it on turn 2.
        [if] {LUA(<<return wesnoth.current.turn==2>>)} {THEN({CLEAR_VARIABLE approached_s02})} [/if]
    [/event]
    {PLACE_POI 17 55 s02
        SCENARIO_FILE=02_Flight_of_the_Elves
        (PREVIEW_WML=
            title=$s02_title
            difficulty,gold=2,1
            recruit1=units/elves-wood/scout/scout.png
            recruit2=units/elves-wood/archer.png
            recruit3=units/elves-wood/fighter/fighter.png
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
            [capture_village]   
                side=2
                x,y,radius=12,56,4
            [/capture_village]
            
            {GENERIC_UNIT 2 "Elvish Fighter" 18 55} {FACING ne} {HITPOINTS 10}
            {GENERIC_UNIT 2 "Elvish Archer"  18 56} {FACING nw} {HITPOINTS 21}
            {GENERIC_UNIT 2 "Elvish Fighter" 16 54} {FACING ne} {HITPOINTS 15}
            
            [if] {VARIABLE_CONDITIONAL bm_s01_isolde_defeated not_equals yes} {THEN(
                {UNSTORE_NPC Isolde x,y=21,54 side,facing=6,sw}
            )} [/if]
            [if] {VARIABLE_CONDITIONAL bm_s01_redmage_defeated not_equals yes} {THEN(
                {GENERIC_UNIT 6 "Red Mage" 20 53} {FACING sw} {LEADER} {GENDER female}
            )} [/if]
            {GENERIC_UNIT 6 Mage       19 55} {FACING sw} {HITPOINTS 3}
            {GENERIC_UNIT 6 Bowman     19 56} {FACING sw}
            {GENERIC_UNIT 6 Spearman   18 54} {FACING sw} {HITPOINTS 29}
            {GENERIC_UNIT 6 Spearman   15 54} {FACING se} {HITPOINTS 17}
            {GENERIC_UNIT 6 Spearman   16 53} {FACING sw}
            {GENERIC_UNIT 6 Spearman   16 57} {FACING ne} {HITPOINTS 21}
            {GENERIC_UNIT 6 Bowman     21 56} {FACING sw}
            {GENERIC_UNIT 6 Bowman     17 53}
            
            {PLACE_FIRE 17 56}
            {PLACE_FIRE 18 53}
            {PLACE_FIRE 19 54}
            {PLACE_FIRE 19 53}
            {PLACE_FIRE 15 53}
            {PLACE_FIRE 20 57}
            {PLACE_FIRE 19 57}
            {PLACE_FIRE 18 57}
        )
        (INCOMPLETE_APPROACHED=
            [if] {LUA(<<return wesnoth.current.turn==1>>)} {THEN(
                # no dialogue on first turn, so we don't overwhelm the player
            )} {ELSE(
                [message]
                    x,y,radius,race=18,55,5,elf
                    message= _ "Konrad, our war is lost! We have tried to flee but human forces encircle us all around. If you don’t act now, none of us may escape!"
                [/message]
            )} [/if]
        )
        (INCOMPLETE_MOVETO=
            [message]
                x,y,radius,race=18,55,5,elf
                message= _ "You’re just in time, Konrad! Help us escape the human armies and flee the burning forest!"
            [/message]
        )
        
        #############################
        # FAILED
        #############################
        (FAILED_MOVETO=
            [message]
                speaker=Konrad
                message= _ "All the elves have either been capturd or perished, and the human army has returned to Weldyn... if only I had acted sooner, some of them might still have been saved."
            [/message]
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
           
        )
        (JUSTCOMPLETED_START=
            {GENERIC_UNIT 2 "Elvish Archer"  13 59} {ROLE s02_speaker_1} {FACING ne} {ANIMATE} {GENDER female}
            {GENERIC_UNIT 2 "Elvish Fighter" 20 59} {ROLE s02_speaker_2} {FACING nw} {ANIMATE}
            [message]
                role=s02_speaker_1
                message= _ "Thank you, Konrad! Many of our number have escaped the fires, and the human army has exhausted its supplies and returned to Weldyn. Lord Kalenz was truly wise when he asked us to raise you as our own; he must have known you would someday save us."
            [/message]
            [message]
                role=s02_speaker_2
                message= _ "Of course, raising Konrad is part of the reason we were attacked in the first place..."
            [/message]
            {KILL role=s02_speaker_1}
            {KILL role=s02_speaker_2}
        )
        (COMPLETED_MOVETO=
            [message]
                speaker=Konrad
                message= _ "The elves have gone into hiding; safely escaped into the southern Aethenwood! May they prosper again once Asheviere is overthrown."
            [/message]
        )
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                   S03 - BLACKWATER PORT
    #######################################################################################################################################################
    [event]
        name=prestart
        {SET_LABEL 9 48 _"Blackwater Port"}
        [if] {LUA(<<return wesnoth.current.turn==3>>)} 
             {VARIABLE_CONDITIONAL status_s03 not_equals in_progress} {THEN(
            {VARIABLE status_s03 failed}
        )} [/if]
    [/event]
#define S03_EMBELLISHMENTS_NOT_FAILED
    {PLACE_PORT 9 48}
    {PLACE_PORT 10 47}
    {BRAZIER_DYNAMIC_OVERWORLD 10 48}
    [capture_village]
        side,x,y=3,7,48
    [/capture_village]
#enddef
    [event]
        name=prestart
        [if] {LUA(<<return wesnoth.current.turn==1>>)} {THEN( {VARIABLE s03_title _"Blackwater Port - 2 seasons remaining"} )} [/if]
        [if] {LUA(<<return wesnoth.current.turn==2>>)} {THEN( {VARIABLE s03_title _"Blackwater Port - 1 season remaining (last chance!)"}  )} [/if]
        # we don't play any approach message on turn 1. Reset approached_s03 so that we might play it on turn 2.
        [if] {LUA(<<return wesnoth.current.turn==2>>)} {THEN({CLEAR_VARIABLE approached_s03})} [/if]
    [/event]
    {PLACE_POI 10 49 s03
        SCENARIO_FILE=03_Blackwater_Port
        (PREVIEW_WML=
            title=$s03_title
            difficulty,gold=2,0
            recruit1=units/human-loyalists/cavalryman/cavalryman.png
            recruit2=units/human-loyalists/horseman/horseman.png
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
            [if] {LUA(<<return wesnoth.current.turn==1>>)} {THEN(
                {FILTER_CONDITION( {VARIABLE_CONDITIONAL status_s03 equals $null} )}
                {FILTER_CONDITION( {LUA(<< return wesnoth.current.turn==1 >>)} )}
                
                {UNSTORE_NPC Kaylan x,y=8,48 side,hitpoints,facing=3,61,se}
                {GENERIC_UNIT 3 Horseman   9 50} {FACING ne} {HITPOINTS 19}
                {GENERIC_UNIT 3 Cavalryman 7 49} {FACING sw}
                {GENERIC_UNIT 3 Peasant    7 48} {FACING ne}
                
                {GENERIC_UNIT 6 Spearman    9 48} {FACING sw} {HITPOINTS 10}
                {GENERIC_UNIT 6 Spearman   10 48} {FACING sw}
                {GENERIC_UNIT 6 Bowman     11 49} {FACING se} {HITPOINTS 23}
                {GENERIC_UNIT 6 Lieutenant 11 48} {FACING sw} {LEADER}
                
                {GENERIC_UNIT 7 "Orcish Archer"   7 50} {FACING ne} {HITPOINTS 18}
                {GENERIC_UNIT 7 "Orcish Archer"   7 51} {FACING ne}
                {GENERIC_UNIT 7 "Goblin Pillager" 6 49} {FACING ne} {LEADER}
                
                {PLACE_IMAGE "scenery/trash.png"       9 49} {PLACE_FIRE  9 49}
                {PLACE_IMAGE "scenery/trash.png~FL()" 10 50} {PLACE_FIRE 10 50}
                {S03_EMBELLISHMENTS_NOT_FAILED}
            )} {ELSE(
                {UNSTORE_NPC Kaylan x,y=8,48 side,hitpoints,facing=3,25,se}
                {GENERIC_UNIT 3 Cavalryman 7 49} {FACING se} {HITPOINTS 28}
                {GENERIC_UNIT 3 Peasant    7 50} {FACING ne}
                
                {GENERIC_UNIT 6 Bowman      9 48} {FACING sw} {HITPOINTS 23}
                {GENERIC_UNIT 6 Spearman    9 49} {FACING sw} {HITPOINTS 3}
                {GENERIC_UNIT 6 Spearman    8 49} {FACING sw}
                {GENERIC_UNIT 6 Lieutenant 10 48} {FACING sw} {LEADER}
                {GENERIC_UNIT 6 Spearman   11 48} {FACING se} # needed to block the port
                
                {GENERIC_UNIT 7 "Orcish Archer"   5 50} {FACING ne} {HITPOINTS 18}
                {GENERIC_UNIT 7 "Goblin Pillager" 6 50} {FACING ne} {HITPOINTS 31} {LEADER}
                {GENERIC_UNIT 7 "Orcish Archer"   6 49} {FACING ne}
                
                {PLACE_IMAGE "scenery/trash.png~FL()" 9 50} {PLACE_FIRE 9 50}
                {PLACE_IMAGE "scenery/trash.png"      6 49} {PLACE_FIRE 6 49}
                {S03_EMBELLISHMENTS_NOT_FAILED}
            )} [/if]
        )
        (INCOMPLETE_APPROACHED=
            [if] {LUA(<<return wesnoth.current.turn==1>>)} {THEN(
                # no dialogue on first turn, so we don't overwhelm the player
            )} {ELSE(
                [message]
                    speaker=Kaylan
                    message= _ "Konrad, I am hard-pressed by the dark queen’s forces! Without your aid, Blackwater Port shall soon fall to ruin!"
                [/message]
            )} [/if]
        )
        (INCOMPLETE_MOVETO=
            [message]
                speaker=Kaylan
                message= _ "Konrad, your timing is impeccable. The dark queen’s forces press me all ’round, but with your aid we can rout their attack and secure Blackwater Port!"
            [/message]
        )
        
        #############################
        # FAILED
        #############################
        (FAILED_PRESTART=
            {MODIFY_TERRAIN Rp^Dr  12 47}
            {MODIFY_TERRAIN Chr    11 48}
            {MODIFY_TERRAIN Chr^Dr 11 49}
            {MODIFY_TERRAIN Ww^Dr  10 47}
            {MODIFY_TERRAIN Isa^Eb 10 48}
            {MODIFY_TERRAIN Ww^Dr   9 48}
            {MODIFY_TERRAIN Khr^Dr  8 48}
            {MODIFY_TERRAIN Chr     8 49}
            {MODIFY_TERRAIN Rp^Vhc  7 48}
            {MODIFY_TERRAIN Chr     7 49}
            {MODIFY_TERRAIN Gs^Dr   7 50}
        )
        (FAILED_MOVETO=
            [message]
                speaker=Konrad
                message= _ "Poor Sir Kaylan has perished. If only I had acted sooner, we might have saved him..."
            [/message]
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
            [if] {VARIABLE_CONDITIONAL stored_kaylan.length greater_than 0} {THEN(
                {GENERIC_UNIT 3 Peasant   7 49} {FACING sw}
                {GENERIC_UNIT 3 Woodsman 11 48} {FACING ne}
                {PLACE_PORT 9 48}
                {PLACE_PORT 10 47}
            )} {ELSE(
                {UNSTORE_NPC Kaylan x,y=8,48 side,facing=3,se}
                {GENERIC_UNIT 3 Cavalryman 7 49} {FACING sw}
                {GENERIC_UNIT 3 Horseman  11 48} {FACING ne}
                {S03_EMBELLISHMENTS_NOT_FAILED}
            )} [/if]
        )
        (JUSTCOMPLETED_START=
            [if] {VARIABLE_CONDITIONAL stored_kaylan.length greater_than 0} {THEN(
                [message]
                    speaker=Konrad
                    message= _ "Alas, poor Sir Kaylan has perished! At least the good people of Blackwater Port are safe."
                [/message]
            )} {ELSE(
                [message]
                    speaker=Kaylan
                    message= _"Gratitude for your aid! With Blackwater Port secure, what remains of Garard’s Royal Cavalry stands at your service, young heir. May they serve you well, as you ride to claim your rightful place on the throne!"
                [/message]
            )} [/if]
        )
        (COMPLETED_MOVETO=
            [message]
                speaker=Kaylan
                message= _ "Thanks again for your aid, young Konrad! May my horsemen serve you well on your journey."
            [/message]
        )
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                  S05 - THE BAY OF PEARLS
    #######################################################################################################################################################
    [event] name=prestart {SET_LABEL 15 39 _"Bay of Pearls"} [/event]
#define S05_EMBELLISHMENTS_NOT_COMPLETED
    {NAMED_UNIT   4 "Mermaid Initiate" 15 41 Midiriel _"Midiriel" ()} {FACING sw}
    {GENERIC_UNIT 4 "Merman Citizen"   14 41                        } {FACING se}
    {GENERIC_UNIT 4 "Merman Brawler"   16 39                        } {FACING sw}
    {MODIFY_UNIT (race=merman {FILTER_LOCATION x,y,radius=15,41,5}) halo items/cage.png}
    {MODIFY_UNIT (race=merman {FILTER_LOCATION x,y,radius=15,41,5}) status.slowed yes}
    
    {GENERIC_UNIT 7 "Orcish Crossbowman" 16 41} {FACING sw} {LEADER}
    {GENERIC_UNIT 7 "Orcish Archer"      17 41} {FACING nw}
    {GENERIC_UNIT 7 "Orcish Grunt"       17 42} {FACING se}
    {GENERIC_UNIT 7 "Naga Fighter"       15 43} {FACING se}
    {GENERIC_UNIT 7 "Naga Fighter"       14 40} {FACING sw}
    {GENERIC_UNIT 7 "Sea Orc"            15 40} {FACING se}
#enddef
    {PLACE_POI 16 42 s05
        SCENARIO_FILE=04_The_Bay_of_Pearls
        (PREVIEW_WML=
            title=_"The Bay of Pearls"
            difficulty,gold=2,1
            recruit1=units/merfolk/brawler.png
            recruit2=units/merfolk/fighter.png
            recruit3=units/merfolk/hunter.png
            recruit4=units/merfolk/initiate.png
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
            {S05_EMBELLISHMENTS_NOT_COMPLETED}
        )
        (INCOMPLETE_APPROACHED=
            [message]
                speaker=Midiriel
                message= _ "Help! When Asheviere’s army marched west, her orcs and their naga allies overran our homes and took us prisoner! Now we slave away all day, pearl diving for the queen."
            [/message]
            [message]
                x,y=16,41
                message= _ "Shut it, you!"
            [/message]
            {ANIMATE_HARM (x,y=16,41) 10 range=melee (type,x,y="Mermaid Initiate",15,41)}
        )
        (INCOMPLETE_MOVETO=
            [message]
                speaker,image=narrator,wesnoth-icon.png
                message=_"This scenario is not yet finished!"
            [/message]
            {MOVE_UNIT id=$unit.id $previous_x $previous_y}
        )
        
        #############################
        # FAILED
        #############################
        (FAILED_PRESTART=
            {S05_EMBELLISHMENTS_NOT_COMPLETED}
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
            {MODIFY_TERRAIN Ds^Dr  15 43}
            {MODIFY_TERRAIN Cer^Dr 16 41}
            {NAMED_UNIT   4 "Mermaid Initiate" 16 40 Midiriel _"Midiriel" ()} {FACING sw}
            {GENERIC_UNIT 4 "Merman Brawler"   17 39                        } {FACING se}
            {GENERIC_UNIT 4 "Merman Citizen"   15 41                        } {FACING sw}
            {GENERIC_UNIT 4 "Merman Fighter"   15 39                        } {FACING se}
            {GENERIC_UNIT 4 "Merman Citizen"   19 38                        } {FACING sw}
        )
        (JUSTCOMPLETED_START=
            [message]
                speaker=Midiriel
                message= _ "We swim free once more! Thank you Konrad. May our warriors serve you well on your quest."
            [/message]
        )
        (COMPLETED_MOVETO=
            [message]
                speaker=Midiriel
                message= _ "We swim free once more! Thank you Konrad. May our warriors serve you well on your quest."
            [/message]
        )
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                     ALDRIL
    #######################################################################################################################################################
    [event] name=prestart {SET_LABEL 22 36 _"Aldril"} [/event]
    {PLACE_PORT 19 37}
    [event]
        name=prestart
        {FILTER_CONDITION({VARIABLE_CONDITIONAL bm_approached_aldril not_equals yes})}
        {NAMED_UNIT 4 Woodsman 24 36 aldril_woodsman _"Woodsman" facing=se}
        
        #############################
        # MEET PEASANT
        #############################
        [event]
            name=enter hex
            {FILTER( side=1 {FILTER_LOCATION( x,y,radius=23,36,3 )} )} # don't let the player move past without triggering this event
            
            [message]
                speaker=aldril_woodsman
                message= _ "Don’ mind me. I’m jus’ a woodsman keeping ’is head down."
            [/message]
            [message]
                speaker=Konrad
                message= _ "Asheviere is an evil queen, woodsman. This is a time for action — join me and help fight for liberty and justice!"
            [/message]
            [message]
                speaker=aldril_woodsman
                message= _ "She’s supposin’ to be the evil one, but here you are asking me to fight and die. Funny, that. If you’ll excuse me, it’s huntin’ season and I have family to feed."
            [/message]
            {MOVE_UNIT id=Konrad 23 38}
            {MODIFY_UNIT id=Konrad          facing ne}
            {MODIFY_UNIT id=aldril_woodsman facing sw}
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "Please? They say there’s more magic in one kind word than in all of Delfador’s enchantments put together."
            [/message]
            [message]
                speaker=aldril_woodsman
                message= _ "Get lost."
            [/message]
            {DELAY 500}
            [message]
                speaker=aldril_woodsman
                message= _ "...ok, fine, here’s a few pieces from the town treasury. Go spend ’em on drink or girls or whatever you soldiers do."
            [/message]
            
            [gold]
                side,amount=1,15 # not enough to make a huge difference, but enough that a serious player might deliberately delay triggering this event until just before a difficult scenario
            [/gold]
            [message]
                speaker=narrator
                message= _"You have gained 15 gold!"
                sound=gold.ogg
            [/message]
            
            {MOVE_UNIT id=aldril_woodsman 27 35}
            {KILL id=aldril_woodsman}
            
            [message]
                speaker=Konrad
                message= _ "If the people all banded together, they could easily depose Asheviere and make life better for everyone. But most just keep quietly to themselves... I guess I can’t blame them."
            [/message]
            [message]
                speaker=Konrad
                message= _ "Maybe that’s what’s so important about being the heir — hope, and a symbol people can rally behind."
            [/message]
            {VARIABLE bm_approached_aldril yes}
        [/event]
    [/event]
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                  S06 - THE ISLE OF ALDUIN
    #######################################################################################################################################################
    [event]
        name=prestart
        {SET_LABEL 6 42 _"Isle of Alduin"}
        {PLACE_PORT 7 44}
    [/event]
    {PLACE_POI 6 43 s06
        APPROACH_RADIUS=2
        
        SCENARIO_FILE=99_Dummy_Scenario
        (PREVIEW_WML=
            title=_"The Isle of Alduin"
            difficulty,gold=1,1
            recruit1=units/human-magi/mage+female.png
            recruit2=units/TODO-IMAGE-rogue-mage.png
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
        )
        (INCOMPLETE_APPROACHED=
            [message]
                speaker,image=narrator,wesnoth-icon.png
                message=_"This scenario is not yet finished!"
            [/message]
        )
        (INCOMPLETE_MOVETO=
            [message]
                speaker,image=narrator,wesnoth-icon.png
                message=_"This scenario is not yet finished!"
            [/message]
            {MOVE_UNIT id=$unit.id $previous_x $previous_y}
        )
        
        #############################
        # FAILED
        #############################
        (FAILED_PRESTART=
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
        )
        (JUSTCOMPLETED_START=
        )
        (COMPLETED_MOVETO=
        )
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                 S07 - MUFF MALALS PENINSULA
    #######################################################################################################################################################
    {PLACE_POI 13 36 s07 APPROACH_RADIUS=2 # so we don't extend into water
        SCENARIO_FILE=07_Muff_Malals_Peninsula
        (PREVIEW_WML=
            title=_"Muff Malal’s Peninsula"
            difficulty,gold=1,1
            companion1=units/moremirmu/white-warrior.png
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
            {NAMED_UNIT   11 "Dark Sorcerer"  12 37 "Muff Malal" _"Muff Malal" (canrecruit=yes)} {FACING ne}
            {GENERIC_UNIT 11 "Walking Corpse" 15 37} {FACING nw} {VARIATION swimmer}
            {GENERIC_UNIT 11 "Soulless"       12 38} {FACING sw}
            {GENERIC_UNIT 11 "Walking Corpse" 13 38} {FACING n }
            {GENERIC_UNIT 11 "Walking Corpse" 12 36} {FACING ne}
            {GENERIC_UNIT 11 "Walking Corpse" 11 37} {FACING se}
            {GENERIC_UNIT 11 "Soulless"       11 36} {FACING ne}
            {GENERIC_UNIT 11 "Walking Corpse"  9 38} {FACING sw} {VARIATION swimmer}
            {GENERIC_UNIT 11 "Walking Corpse" 16 35} {FACING sw}
            {UNSTORE_NPC Moremirmu x,y=13,37 side,facing=4,sw}
        )
        (INCOMPLETE_APPROACHED=
            [message]
                speaker=Moremirmu
                message= _ "The Light rebukes you, foul necromancer! Flee as you may, you cannot escape my wrath!"
            [/message]
            [message]
                speaker=Muff Malal
                message= _ "Well well, aren’t you a squeaky little toy! I wonder what new noises you’ll make after I kill you and raise your corpse."
            [/message]
        )
        (INCOMPLETE_MOVETO=
            [message]
                speaker=Muff Malal
                message= _ "Can’t you see I’m busy? Stay out of this or you’ll regret it!"
            [/message]
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
            {MODIFY_TERRAIN Gd^Dr  12 37}
            {MODIFY_TERRAIN Chr^Dr 13 37}
            {MODIFY_TERRAIN Gd^Dr  16 35}
        )
        (JUSTCOMPLETED_START=
            # remember, Moremirmu might be dead here
            {MOVE_UNDER_KONRAD(
                {RECALL_XY Moremirmu $stored_konrad.x $stored_konrad.y}
                {MOVE_UNIT id=Moremirmu "$($stored_konrad.x-1)" $stored_konrad.y}
                {MODIFY_UNIT id=Moremirmu facing se} {MODIFY_UNIT id=Konrad facing sw}
            )}
            [message]
                speaker=Moremirmu
                message= _ "Lo! We have cleansed a great evil here today, my friend. Together we shall fight onwards on against evil!"
            [/message]
            {MOVE_UNDER_KONRAD( {MOVE_UNIT id=Moremirmu $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST id=Moremirmu} )}
        )
        (COMPLETED_MOVETO=
            [message]
                speaker=Konrad
                message= _ "With Muff Malal defeated, in time this land may heal. We did a good deed here."
            [/message]
        )
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                               S08a - ISLE OF THE DAMNED, PART 1
    #######################################################################################################################################################
    [event] name=prestart
        {SET_LABEL 3 33 _"The Three Sisters"}
        {SET_LABEL 5 19 _"Elensefar Reef"}
        {PLACE_IMAGE scenery/temple-cracked2.png 2 31}
        [if] {VARIABLE_CONDITIONAL status_s30 not_equals completed} {THEN(
            {ADD_MULTIHEX_WIND x,y=1-8,10-40 "~FL()"} # only before the sceptre, to save on CPU
        )} [/if]
    [/event]
    {PLACE_POI 3 32 s08a
        APPROACH_RADIUS=5
        
        SCENARIO_FILE=08a_Isle_of_the_Damned_part1
        (PREVIEW_WML=
            title=_"Isle of the Damned" # don't say "part 1", since the second half is hidden at first
            preview=bigmap/preview-shroud.png
            difficulty,gold=1,1
            recruit1=units/human-outlaws/thug.png
            recruit2=units/human-outlaws/poacher.png
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
            # place a port if Konrad needs to go find the sceptre
            [if] {VARIABLE_CONDITIONAL bm_turns equals $bm_milestone_scepter} {THEN(
                {PLACE_PORT 5 31}
            )} [/if]
        )
        (INCOMPLETE_APPROACHED=
            # don't trigger this storm if Konrad needs to go find the sceptre
            [if] {VARIABLE_CONDITIONAL bm_turns not_equals $bm_milestone_scepter} {THEN(
                [cancel_action]
                [/cancel_action]
                {SOUND skill-blizzard.wav}
                {FADE_MUSIC_OUT 250}
                [message]
                    speaker=Konrad
                    message= _ "Hold a moment. Do you hear that?"
                [/message]
                {DELAY 500}
                {SCREEN_FADER 200,200,255 100 0}
                {SOUND lightning.ogg}
                {DELAY 150}
                [replace_schedule]
                    {SCHEDULE_SEASONS_WITH_WEATHER}
                [/replace_schedule]
                {SCREEN_FADER 200,200,255   0 0}
                {DELAY 750}
                [message]
                    speaker=Konrad {KONRAD_VARIATION mad}
                    message= _ "We’re caught in a storm! These boats aren’t built to maneuver in rough weather — the wind is blowing us towards that island. Brace!"
                [/message]
                {SOUND water.wav}
                {MOVE_UNIT id=Konrad 6 32}
                {PLACE_IMAGE "scenery/wreck.png~FL()" 6 32}
                {SOUND golem-crush.wav}
                {FIRE_EVENT disembark_konrad}
                {MOVE_UNIT id=Konrad 5 32}
                {FADE_MUSIC_IN 500}
                [message]
                    speaker=Konrad
                    message= _ "Whew, we survived ...but the boats are smashed to bits. Where is this place?"
                [/message]
            )} [/if]
        )
        (INCOMPLETE_MOVETO=
            [message]
                speaker=Konrad
                message= _ "I suppose we may as well explore while we’re marooned."
            [/message]
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
            {NAMED_UNIT 4 "Outlaw" 4 31 Delurin _"Delurin" ()} {FACING se}
            {PLACE_PORT 5 31}
        )
        (JUSTCOMPLETED_START=
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "I’m glad I could help make safe your home, but... why choose to live here, of all places? There must be safer hideouts than an island crawling with undead!"
            [/message]
            [message]
                speaker=Delurin
                message= _ "Naw, weren’t always like this. The Three Sisters’ve always been good to us — tough, but fair. These undead be a new thing."
            [/message]
            [message]
                speaker=Delurin
                message= _ "There’s some old crypts on the west side o’ the island, see? Our leader went down, huntin’ for weapons, treasure, magic and what have ye. But instead o’ her comin’ back out, all we got was hordes o’ the dead."
            [/message]
            [message]
                speaker=Delurin
                message= _ "Her an’ some o’ her girls are still down there, trapped — or dead. If’n you can help, we’d all be in yer debt.

If not... well, there’s our port. I’ve got some ships t’ take ye back to th’ mainland. We owe you that much."
            [/message]
        )
        (COMPLETED_MOVETO=
        )
    }
    #######################################################################################################################################################
    #                                                               S08b - ISLE OF THE DAMNED, PART 2
    #######################################################################################################################################################
    {PLACE_POI 2 31 s08b
        (CONDITION={VARIABLE_CONDITIONAL status_s08a equals completed}) # only show this POI if we've completed part 1
        
        SCENARIO_FILE=08b_Isle_of_the_Damned_part2
        (PREVIEW_WML=
            title=_"Isle of the Damned II"
            preview=bigmap/preview-shroud.png
            difficulty,gold=2,1
            recruit1="units/human-outlaws/footpad+female.png"
            companion1="units/human-outlaws/fugitive+female.png"
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
        )
        (INCOMPLETE_APPROACHED=
        )
        (INCOMPLETE_MOVETO=
            {MODIFY_UNIT id=Delurin facing sw}
            [message]
                speaker=Delurin
                message= _ "Our leader an’ some o’ her girls are still down there undergroud, trapped — or dead. If’n you can help, we’d all be in yer debt."
            [/message]
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
            [remove_item]
                image=completed # otherwise we have 2 "completed" indicators right next to each-other, which looks funny
                x,y=2,31
            [/remove_item]
            {RECALL_XY Harper 3 33}
            {MODIFY_UNIT id=Harper facing sw}
        )
        (JUSTCOMPLETED_START=
            [message]
                speaker=Harper
                message= _ "...a prince? No kiddin’. Never thought I’d be friends with blue blood."
            [/message]
            [message]
                speaker=Harper
                message= _ "Well. Listen, if you’re fightin’ Asheviere, then me an’ my footpads are with you; we want to help. It’s about time someone did somethin’ ’bout her."
            [/message]
            {NEW_RECRUIT1 Footpad _"Konrad can now recruit Footpads!" "human-outlaws/footpad.png"}
            {MOVE_UNDER_KONRAD( {MOVE_UNIT id=Harper $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST id=Harper} )}
            {FIRE_EVENT_UNIT moveto id=Konrad} # trigger COMPLETED_MOVETO
        )
        (COMPLETED_MOVETO=
            [message]
                speaker=Delurin
                message= _ "Thank you again fer how much help you’ve been, Konrad! The Three Sisters’re in your debt, now an’ ferever. Go an’ give Asheviere hell."
            [/message]
        )
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                        CARCYN
    #######################################################################################################################################################
    [event] name=prestart {SET_LABEL 29 29 _"Carcyn"} [/event]
    #############################
    # PREPARE SHIPS
    #############################
    [event]
        name=prestart
        {FILTER_CONDITION({VARIABLE_CONDITIONAL bm_completed_carcyn not_equals yes})}
        
        # different positions pre/post Elensefar
        [if] {LUA(<<return wesnoth.current.turn>=wml.variables['bm_milestone_elensefar']>>)}
             {OR({VARIABLE_CONDITIONAL status_s10 equals in_progress})}
             {OR({VARIABLE_CONDITIONAL status_s10 equals completed})}
        {THEN(
            {GENERIC_UNIT 6 "Galleon" 28 27} {FACING se} {ROLE carcyn_ship1}
            {GENERIC_UNIT 6 "Boat"    31 28} {FACING sw} {ROLE carcyn_ship2}
        )} {ELSE(
            {GENERIC_UNIT 6 "Galleon" 28 27} {FACING se} {ROLE carcyn_ship1}
            {GENERIC_UNIT 6 "Boat"    31 28} {FACING sw} {ROLE carcyn_ship2}
            {GENERIC_UNIT 6 "Galleon" 23 27} {FACING sw}
        )} [/if]
    [/event]
    [event]
        name=prestart
        {FILTER_CONDITION({VARIABLE_CONDITIONAL bm_completed_carcyn equals yes})}
        {GENERIC_UNIT 3 Boat 32 29} {FACING se}
        {GENERIC_UNIT 3 Boat 28 28} {FACING sw}
        {PLACE_PORT 29 29}
    [/event]
    #############################
    # KONRAD ARRIVES
    #############################
    [event]
        name,first_time_only=moveto,no
        {FILTER( id=Konrad {FILTER_LOCATION x,y,radius=29,29,1} )}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL bm_completed_carcyn not_equals yes})}
        
        # Delfador can't get here, so we don't need to worry about him levitating across.
        # If the player tries to approach, Elensefar gets spotted, and Delfador goes off to help Elensefar instead
        
        # merfolk
        [if] {VARIABLE_CONDITIONAL status_s05 equals completed}{THEN(
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "There is a small port here, but most of the ships have been seized and sailed away! Those that remain are out in the river, filled with soldiers."
            [/message]
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "Many of the townsfolk relied on those boats for their livelihood. We have to do something!"
            [/message]
            {MOVE_UNDER_KONRAD(
                {GENERIC_UNIT 1 "Merman Brawler" $stored_konrad.x $stored_konrad.y} {ROLE merman1} {MOVE_UNIT role=merman1 28 28}
                {GENERIC_UNIT 1 "Merman Fighter" $stored_konrad.x $stored_konrad.y} {ROLE merman2} {MOVE_UNIT role=merman2 29 28}
                {GENERIC_UNIT 1 "Merman Fighter" $stored_konrad.x $stored_konrad.y} {ROLE merman3} {MOVE_UNIT role=merman3 30 28}
            )}
            [message]
                role=merman2
                message= _ "Leave it to us, prince Konrad!"
            [/message]
            {ANIMATE_HARM role=merman2 10 range=melee role=carcyn_ship1 KILL=no}
            {MOVE_UNIT role=merman1 27 27}
            {ANIMATE_HARM role=merman1 10 range=melee role=carcyn_ship1 KILL=yes}
            {ANIMATE_HARM role=merman3 10 range=melee role=carcyn_ship2 KILL=no}
            {MOVE_UNIT role=carcyn_ship2 43 25} {KILL role=carcyn_ship2}
            [message]
                role=merman2
                message= _ "Now bring the rest of the boats back to port."
            [/message]
            {MOVE_UNDER_KONRAD( {MOVE_UNIT role=merman1 $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST role=merman1} )}
            {MOVE_UNDER_KONRAD( {MOVE_UNIT role=merman2 $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST role=merman2} )}
            {MOVE_UNDER_KONRAD( {MOVE_UNIT role=merman3 $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST role=merman3} )}
            {GENERIC_UNIT 3 Boat 32 29} {FACING se} {ANIMATE}
            {GENERIC_UNIT 3 Boat 28 28} {FACING sw} {ANIMATE}
            {PLACE_PORT 29 29}
            {VARIABLE bm_completed_carcyn yes}
        )}
        
        # gryphons
        [elseif] {VARIABLE_CONDITIONAL status_s14 equals completed} {VARIABLE_CONDITIONAL bm_s14_fought_burlin not_equals yes}  {THEN(
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "There is a small port here, but most of the ships have been seized and sailed away! Those that remain are out in the river, filled with soldiers."
            [/message]
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "Many of the townsfolk relied on those boats for their livelihood. We have to do something!"
            [/message]
            {MOVE_UNDER_KONRAD(
                {GENERIC_UNIT 1 "Gryphon Rider" $stored_konrad.x $stored_konrad.y} {ROLE gryphon1} {MOVE_UNIT role=gryphon1 28 28}
                {GENERIC_UNIT 1 "Gryphon Rider" $stored_konrad.x $stored_konrad.y} {ROLE gryphon2} {MOVE_UNIT role=gryphon2 30 28}
            )}
            [message]
                role=gryphon1
                message= _ "Leave it to us, prince Konrad!"
            [/message]
            {MOVE_UNIT role=gryphon1 27 27}
            {ANIMATE_HARM role=gryphon1 10 range=melee role=carcyn_ship1 KILL=yes}
            {ANIMATE_HARM role=gryphon2 10 range=melee role=carcyn_ship2 KILL=no}
            {MOVE_UNIT role=carcyn_ship2 43 25} {KILL role=carcyn_ship2}
            [message]
                role=gryphon1
                message= _ "Now bring the rest of the boats back to port."
            [/message]
            {MOVE_UNDER_KONRAD( {MOVE_UNIT role=gryphon1 $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST role=gryphon1} )}
            {MOVE_UNDER_KONRAD( {MOVE_UNIT role=gryphon2 $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST role=gryphon2} )}
            {GENERIC_UNIT 3 Boat 32 29} {FACING se} {ANIMATE}
            {GENERIC_UNIT 3 Boat 28 28} {FACING sw} {ANIMATE}
            {PLACE_PORT 29 29}
            {VARIABLE bm_completed_carcyn yes}
        )} [/elseif]
        
        # seafarer's sandals
        [elseif] {VARIABLE_CONDITIONAL status_s11 equals completed}  {THEN(
            [message]
                speaker=Konrad
                message= _ "There is a small port here, but most of the ships have been seized and sailed away! Those that remain are out in the river, filled with soldiers."
            [/message]
            [message]
                speaker=Konrad
                message= _ "Many of the townsfolk relied on those boats for their livelihood. We have to do something — and with my magical water-walking sandals, maybe I can."
            [/message]
            [hide_unit]
                id=Konrad
            [/hide_unit]
            {STORE_UNIT_VAR id=Konrad type konrad_type}
            {DO_AT_COORDS id=Konrad ({FAKE_UNIT_MOVE $coordX 28 $coordY 27   1 $konrad_type ()})}
            
            {DELAY 250}
            {SOUND sword-1.ogg} {DELAY 300}
            {SOUND sword-1.ogg} {DELAY 400}
            {SOUND human-hit-4.ogg} {DELAY 750}
            {SOUND sword-1.ogg} {DELAY 400}
            {SOUND human-die-2.ogg} {DELAY 500}
            
            {KILL role=carcyn_ship1}
            {DO_AT_COORDS id=Konrad ({FAKE_UNIT_MOVE 28 $coordX 27 $coordY   1 $konrad_type ()})}
            {CLEAR_VARIABLE konrad_type}
            [unhide_unit]
                id=Konrad
            [/unhide_unit]
            
            {MOVE_UNIT role=carcyn_ship2 43 25} {KILL role=carcyn_ship2}
            [message]
                speaker=Konrad {KONRAD_VARIATION glad}
                message= _ "I have chased off the worst of the soldiers, and brought the remaining boats back to port! Doing this by myself was very dangerous and I got very lucky, but I am glad to have taken the risk and helped this town."
            [/message]
            
            {GENERIC_UNIT 3 Boat 32 29} {FACING se} {ANIMATE}
            {GENERIC_UNIT 3 Boat 28 28} {FACING sw} {ANIMATE}
            {PLACE_PORT 29 29}
            {VARIABLE bm_completed_carcyn yes}
        )} [/elseif]
        
        # no amphibious units
        {ELSE(
            [message]
                speaker=Konrad {KONRAD_VARIATION concerned}
                message= _ "There is a small port here, but all of the ships have been seized and sailed away! Some hang just out of reach, as if to taunt us..."
            [/message]
        )} [/if]
    [/event]
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                             HALSTEAD, DELWYN, AND DALLBEN
    #######################################################################################################################################################
    #############################
    # HALSTEAD
    #############################
    [event]
        name=enter hex
        {FILTER( side=1 {FILTER_LOCATION( x,y,radius=18,31,3 )} )}
        {FILTER_CONDITION({HAVE_UNIT id,side,search_recall_list=Harper,1,yes})}
        
        [cancel_action]
        [/cancel_action]
        {MOVE_UNDER_KONRAD(
            {RECALL_XY Harper $stored_konrad.x $stored_konrad.y}
            {MOVE_UNIT id=Harper "$($stored_konrad.x-1)" $stored_konrad.y}
            {MODIFY_UNIT id=Harper facing se}
        )}
        [message]
            speaker=Harper
            message=_"There it be — what’s left of Halstead. You woulda been barely a year or two old, Konrad. It were a nasty fight, but in the end we knocked the whole thing down, Baldras and I did. I miss him something fierce."
        [/message]
        [message]
            speaker=Konrad
            message=_"Baldras was your uncle, is that right? Is he not back with the others on the Three Sisters?"
        [/message]
        [message]
            speaker=Harper
            message=_"No. He an’ some o’ the family went off to try and rescue a bunch of slaves, somewhere out eastways. Do a good deed, an’ maybe make us some new friends too, you know? But it’s been years, and not one of thems that went out has come back."
        [/message]
        [message]
            speaker=Harper
            message=_"Delurin says they’re probably all dead, but I refuse t’ believe it. My uncle Baldras is tougher than that..."
        [/message]
        {MOVE_UNDER_KONRAD( {MOVE_UNIT id=Harper $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST id=Harper} )}
    [/event]
    #############################
    # DELWYN AND DALLBEN
    #############################
    [event]
        name=enter hex
        {FILTER( side=1 {FILTER_LOCATION( x,y,radius=21,19,1 )} )}
        {FILTER_CONDITION({HAVE_UNIT id,side,search_recall_list=Harper,1,yes})}
        
        [cancel_action]
        [/cancel_action]
        {MOVE_UNDER_KONRAD(
            {RECALL_XY Harper $stored_konrad.x $stored_konrad.y}
            {MOVE_UNIT id=Harper "$($stored_konrad.x-1)" $stored_konrad.y}
            {MODIFY_UNIT id=Harper facing se}
        )}
        [message]
            speaker=Harper
            message=_"Dallben, my home. Might look like jus’ another ruined town to you, but this place was once full of life an’ adventure!"
        [/message]
        [message]
            speaker=Harper
            message=_"’course everythin’ fell apart come Asheviere. We had to run fer our lives an’ hide, an’ now all’s left is memories. Lotsa stories like ours these days."
        [/message]
        [message]
            speaker=Harper
            message=_"Wait up a moment, Konrad. I might still be able to scrounge up a li’l gold for us."
        [/message]
        [message]
            speaker,image=narrator,wesnoth-icon.png
            message=_"You have gained 40 gold!"
        [/message]
        {SOUND gold.ogg}
        [gold]
            side,amount=1,40
        [/gold]
        {MOVE_UNDER_KONRAD( {MOVE_UNIT id=Harper $stored_konrad.x $stored_konrad.y} {PUT_TO_RECALL_LIST id=Harper} )}
    [/event]
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                  S10 - ELENSEFAR BEFORE
    #######################################################################################################################################################
    [event]
        name=prestart
        {SET_LABEL 18 21 _"Elensefar"}
        {SET_LABEL 19 31 _"Halstead" }
        [if] {LUA(<<return wesnoth.current.turn==wml.variables['bm_milestone_elensefar']-3>>)} {THEN( {VARIABLE s10_title _"The Siege of Elensefar - 3 seasons remaining"} )} [/if]
        [if] {LUA(<<return wesnoth.current.turn==wml.variables['bm_milestone_elensefar']-2>>)} {THEN( {VARIABLE s10_title _"The Siege of Elensefar - 2 seasons remaining"} )} [/if]
        [if] {LUA(<<return wesnoth.current.turn==wml.variables['bm_milestone_elensefar']-1>>)} {THEN( {VARIABLE s10_title _"The Siege of Elensefar - 1 season remaining (last chance!)"} )} [/if]
    [/event]
#define ELENSEFAR_UNCONQUERED_TERRAIN
    {MODIFY_TERRAIN Rr^VjD  20 22}
    {MODIFY_TERRAIN Rr^VjD  19 22}
    {MODIFY_TERRAIN Rr^VjB  19 23}
    {MODIFY_TERRAIN Rr^Vhc  17 23}
    {MODIFY_TERRAIN Isa^Vhc 16 22}
    {MODIFY_TERRAIN Wwg^Bw/ 16 23}
    {MODIFY_TERRAIN Wwg^Bw/ 15 23}
    {MODIFY_TERRAIN Kh      17 22}
    {MODIFY_TERRAIN Ch      16 21}
    {MODIFY_TERRAIN Ch      17 21}
    {MODIFY_TERRAIN Ch      19 24}
    {MODIFY_TERRAIN Rr^Ebn  18 23}
    {BRAZIER_DYNAMIC_OVERWORLD 18 23}
    [item]
        x,y,halo=20,23,items/fountain-[01~13].png:100
    [/item]
#enddef
#define ELENSEFAR_ATTACKER_TERRAIN
    {MODIFY_TERRAIN Rp^Ecf  15 27}
    {MODIFY_TERRAIN Rp^Ecf  20 27}
    {MODIFY_TERRAIN Rb^Vct  15 28}
    {MODIFY_TERRAIN Rb^Vct  16 27}
    {MODIFY_TERRAIN Rb^Vct  19 28}
    {MODIFY_TERRAIN Rb^Vct  21 27}
    {MODIFY_TERRAIN Rb^Vct  22 27}
    {MODIFY_TERRAIN Gs^Vct  20 26}
#enddef
#define ELENSEFAR_WRECKS
    {PLACE_IMAGE "scenery/wreck-3.png"      15 24}
    {PLACE_IMAGE "scenery/wreck-3.png~FL()" 24 25}
    {PLACE_IMAGE "scenery/wreck.png"        23 24}
#enddef
    {PLACE_POI 18 22 s10 # if I change SNUM, also change the secondary POI's fire_event
        APPROACH_RADIUS=9 # if I change radius, verify we're still smaller than the "delfador goes to elensefar" alternative trigger
        
        SCENARIO_FILE=10_Elensefar_Before
        (CONDITION={LUA(<<return wesnoth.current.turn<(wml.variables['bm_milestone_elensefar'])>>)} # only show this poi BEFORE Li'sar conquers Elensefar
            {OR( {VARIABLE_CONDITIONAL status_s10 equals in_progress} )}
            {OR( {VARIABLE_CONDITIONAL status_s10 equals completed} )} # always show this POI if we've completed it
        )
        (PREVIEW_WML=
            title=$s10_title
            difficulty,gold=3,2
            recruit1=units/human-loyalists/swordsman.png
            recruit2=units/human-loyalists/pikeman.png
            recruit3=units/human-outlaws/thief.png
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
            #------------------------
            # SECONDARY POIS
            #------------------------
            {REMOVE_IMAGE 18 22}
            
            # southeast
            {PLACE_IMAGE bigmap/poi-battle.png 21 28}
            [event]
                name,first_time_only=enter hex,no
                {FILTER id,x,y=Konrad,21,28}
                {VARIABLE previous_x $x2}{VARIABLE previous_y $y2}
                {FIRE_EVENT_UNIT preview_poi_s10 id=$unit.id}
            [/event]
            
            # southwest
            {PLACE_IMAGE bigmap/poi-battle.png 12 27}
            [event]
                name,first_time_only=enter hex,no
                {FILTER id,x,y=Konrad,12,27}
                {VARIABLE s10_from_west yes}
                {VARIABLE previous_x $x2}{VARIABLE previous_y $y2}
                {FIRE_EVENT_UNIT preview_poi_s10 id=$unit.id}
            [/event]
            
            # north
            {PLACE_IMAGE bigmap/poi-battle.png 21 19}
            [event]
                name,first_time_only=enter hex,no
                {FILTER id,x,y=Konrad,21,19}
                {VARIABLE s10_from_north yes}
                {VARIABLE previous_x $x2}{VARIABLE previous_y $y2}
                {FIRE_EVENT_UNIT preview_poi_s10 id=$unit.id}
            [/event]
            
            #------------------------
            # ELENSEFAR
            #------------------------
            {UNSTORE_NPC Maddock x,y=17,22 side,facing=3,se}
            [if] {VARIABLE_CONDITIONAL bm_delfador_left equals yes} {THEN( {UNSTORE_NPC Delfador x,y=19,24 side,facing=3,sw} )} [/if]
            {GENERIC_UNIT 3 Swordsman  16 22} {FACING se}
            {GENERIC_UNIT 3 Swordsman  15 23} {FACING sw}
            {GENERIC_UNIT 3 Pikeman    16 23} {FACING se} {HITPOINTS 5}
            {GENERIC_UNIT 3 Thief      18 23} {FACING sw} {GENDER female} {HITPOINTS 30}
            {GENERIC_UNIT 3 Swordsman  19 22} {FACING sw}
            {GENERIC_UNIT 3 Thief      20 22} {FACING ne} {GENDER male}
            
            {ELENSEFAR_WRECKS}
            {GENERIC_UNIT 3 "Caravel" 18 20} {FACING se} {HITPOINTS 45}
            {GENERIC_UNIT 3 "Caravel" 14 23} {FACING se}
            {GENERIC_UNIT 3 "Caravel" 21 23} {FACING sw}
            # Wesnoth ships are handled by the Carcyn section
            
            #------------------------
            # ORCS
            #------------------------
            {GENERIC_UNIT 7 "Orcish Slurbow"     22 19} {FACING sw} {LEADER}
            {GENERIC_UNIT 7 "Goblin Pillager"    23 20} {FACING se}
            {GENERIC_UNIT 7 "Goblin Pillager"    22 20} {FACING sw}
            {GENERIC_UNIT 7 "Orcish Grunt"       19 19} {FACING sw}
            {GENERIC_UNIT 7 "Orcish Archer"      20 19} {FACING se}
            {GENERIC_UNIT 7 "Orcish Crossbowman" 20 20} {FACING sw}
            {GENERIC_UNIT 7 "Orcish Archer"      19 21} {FACING sw} {HITPOINTS 10}
            
            #------------------------
            # ARMY OF WESNOTH
            #------------------------
            {GENERIC_UNIT 6 Spearman   16 24} {FACING n} {HITPOINTS 12}
            {GENERIC_UNIT 6 Spearman   17 24} {FACING n} {HITPOINTS 31}
            {GENERIC_UNIT 6 Spearman   18 24} {FACING n} {HITPOINTS 28} {ROLE elsenefar_fodder2}
            {GENERIC_UNIT 6 Spearman   19 25} {FACING n} {HITPOINTS 11} {ROLE elsenefar_fodder1}
            {GENERIC_UNIT 6 Lieutenant 17 25} {FACING ne} {LEADER}
            
            {GENERIC_UNIT 6 Halberdier 21 27} {FACING se} {LEADER}
            {GENERIC_UNIT 6 Spearman   20 26} {FACING nw}
            {GENERIC_UNIT 6 Spearman   22 26} {FACING nw}
            {GENERIC_UNIT 6 Spearman   19 28} {FACING nw}
            {GENERIC_UNIT 6 Bowman     20 28} {FACING ne}
            {GENERIC_UNIT 6 Longbowman 19 29} {FACING ne}
            
            {GENERIC_UNIT 6 Longbowman 16 26} {FACING sw} {LEADER}
            {GENERIC_UNIT 6 Bowman     14 26} {FACING ne}
            {GENERIC_UNIT 6 Spearman   15 26} {FACING se}
            {GENERIC_UNIT 6 Fencer     15 28} {FACING se}
            {GENERIC_UNIT 6 Fencer     17 28} {FACING nw}
            {GENERIC_UNIT 6 Bowman     16 28} {FACING se}
            {GENERIC_UNIT 6 Fencer     18 28} {FACING se}
            
            {GENERIC_UNIT 6 Spearman   24 30} {FACING se}
            {GENERIC_UNIT 6 Spearman   17 32} {FACING sw}
            
            #------------------------
            # TERRAIN
            #------------------------
            {ELENSEFAR_UNCONQUERED_TERRAIN}
            {ELENSEFAR_ATTACKER_TERRAIN}
            {MODIFY_TERRAIN Rp^Ecf 20 27}
            {MODIFY_TERRAIN Rp^Ecf 15 27}
            {MODIFY_TERRAIN Gs^Vct 20 26}
            {MODIFY_TERRAIN Rb^Vct 15 28}
            {MODIFY_TERRAIN Rb^Vct 16 27}
            {MODIFY_TERRAIN Rb^Vct 21 27}
            {MODIFY_TERRAIN Rb^Vct 22 27}
            [capture_village]
                side,x,y,radius=6,19,28,4
            [/capture_village]
            {PLACE_FIRE 18 21} {PLACE_IMAGE "scenery/trash.png~FL()" 18 21}
            {PLACE_FIRE 17 21}
            {PLACE_FIRE 19 25} {PLACE_IMAGE "scenery/trash.png"      19 25}
        )
        (INCOMPLETE_APPROACHED=
            {REVEAL x,y,radius=18,23,6}
            {SCROLL_TO 18 23}
            [message]
                speaker,scroll=Konrad,no
                message= _ "Delfador, I’ve come to Elensefar to help! Together we can fight off the besieging armies!"
            [/message]
            {ANIMATE_HARM id=Delfador 99 range=ranged role=elsenefar_fodder1}
            {DELAY 250}
            {ANIMATE_HARM id=Delfador 14 range=ranged role=elsenefar_fodder2}
            {ANIMATE_HARM id=Delfador 99 range=ranged role=elsenefar_fodder2}
            [message]
                speaker=Delfador {DELFADOR_VARIATION mad}
                message= _ "Don’t be daft, Konrad. You must be kept safe! This battle is too dangerous for you — keep your distance and do your good elsewhere."
            [/message]
        )
        (INCOMPLETE_MOVETO=
            [message]
                speaker=Delfador
                message= _ "Fighting here is a poor decision, master Konrad. But if you insist on joining the battle, Maddock and I can certainly use your help."
            [/message]
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
            {ELENSEFAR_UNCONQUERED_TERRAIN}
            {ELENSEFAR_WRECKS}
            
            {UNSTORE_NPC Maddock x,y=17,22 side,facing=3,se}
            {GENERIC_UNIT 3 "Caravel" 15 24} {FACING se}
            {GENERIC_UNIT 3 Swordsman 16 21} {FACING nw}
            {GENERIC_UNIT 3 Swordsman 19 22} {FACING nw}
            {GENERIC_UNIT 3 Pikeman   19 24} {FACING sw}
            {GENERIC_UNIT 3 Swordsman 16 26} {FACING se}
            {GENERIC_UNIT 3 Thief     20 22} {FACING se} {GENDER female}
        )
        (JUSTCOMPLETED_START=
            {FIRE_EVENT kalenz_arrives}
        )
        (COMPLETED_MOVETO=
            
        )
    }
    #######################################################################################################################################################
    #                                                                  S11 - ELENSEFAR AFTER
    #######################################################################################################################################################
    {PLACE_POI 18 22 s11 # if I change snum, also change the secondary POI's fire_event
        APPROACH_RADIUS=6
        SCENARIO_FILE=11_Elensefar_After
        (CONDITION={LUA(<<return wesnoth.current.turn>=(wml.variables['bm_milestone_elensefar'])>>)} # only show this poi AFTER Li'sar conquers Elensefar
                   {VARIABLE_CONDITIONAL status_s10 not_equals completed} # never show this POI if we've already completed S10 Elensefar Before
        )
        (PREVIEW_WML=
            title=_"The Silver City"
            difficulty,gold=2,2
            recruit1="units/human-outlaws/thief+female.png"
            otherlabel=_"Item for Konrad: <span color='#EFBF04'><b>full movement and 40% defense on water, swamp, & frozen</b></span>"
        )
        #############################
        # INCOMPLETE
        #############################
        (INCOMPLETE_PRESTART=
            #------------------------
            # SECONDARY POIS
            #------------------------
            {REMOVE_IMAGE 18 22}
            
            # north
            {PLACE_IMAGE bigmap/poi-battle.png 20 20}
            [event]
                name,first_time_only=enter hex,no
                {FILTER id,x,y=Konrad,20,20}
                {VARIABLE s10_from_north yes}
                {VARIABLE previous_x $x2}{VARIABLE previous_y $y2}
                {FIRE_EVENT_UNIT preview_poi_s11 id=$unit.id}
            [/event]
            
            # south
            {PLACE_IMAGE bigmap/poi-battle.png 17 26}
            [event]
                name,first_time_only=enter hex,no
                {FILTER id,x,y=Konrad,17,26}
                {VARIABLE previous_x $x2}{VARIABLE previous_y $y2}
                {FIRE_EVENT_UNIT preview_poi_s11 id=$unit.id}
            [/event]
            
            #------------------------
            # ORCS
            #------------------------
            {GENERIC_UNIT 7 "Orcish Slurbow"     17 22} {FACING se} {LEADER} {ROLE elensefar_orc_leader1}
            {GENERIC_UNIT 7 "Goblin Pillager"    19 24} {FACING sw} {LEADER} {ROLE elensefar_orc_leader2}
            {GENERIC_UNIT 7 "Orcish Archer"      20 23} {FACING se}
            {GENERIC_UNIT 7 "Orcish Grunt"       19 22} {FACING nw}
            {GENERIC_UNIT 7 "Orcish Archer"      17 23} {FACING se}
            {GENERIC_UNIT 7 "Orcish Archer"      16 23} {FACING se}
            {GENERIC_UNIT 7 "Goblin Pillager"    16 21} {FACING sw}
        )
        (INCOMPLETE_APPROACHED=
            {SCROLL_TO 18 22}
            {REVEAL x,y,radius=18,22,4}
            {MOVE_UNIT role=elensefar_orc_leader2 19 23} {DELAY 250}
            {SOUND torch.ogg} {DELAY 250} {SOUND gold.ogg}
            {PLACE_FIRE 19 23}
            {MOVE_UNIT role=elensefar_orc_leader2 19 24}
            {DELAY 250}
            [message]
                role=elensefar_orc_leader2
                message= _ "Look at all this gold! Tear up the floorboards; don’t let ’em hide a thing."
            [/message]
            [message]
                speaker=Konrad {KONRAD_VARIATION mad}
                message= _ "Leave Elensefar alone, you villains! Rule under Asheviere would have been bad enough, but orcs?!"
            [/message]
            [message]
                role=elensefar_orc_leader1
                message= _ "Don’t try anything stupid, wretch. Your queen gave us this place fair and square, and we’re not givin’ it up so easy!"
            [/message]
        )
        (INCOMPLETE_MOVETO=
            [message]
                role=elensefar_orc_leader1
                message= _ "Get lost, pinkskin! Elensefar is our city now."
            [/message]
            [message]
                speaker=Konrad {KONRAD_VARIATION mad}
                message= _ "Not if my sword has anything to say about it!"
            [/message]
        )
        
        #############################
        # COMPLETED
        #############################
        (COMPLETED_PRESTART=
            {UNSTORE_NPC Reglok x,y=17,22 side,facing=4,se}
            {GENERIC_UNIT 4 Thief 16 22} {FACING se} {ROLE elensefar_completed_thief}
            {GENERIC_UNIT 4 Thief 19 24} {FACING sw} {GENDER female}
            
            {GENERIC_UNIT 4 Peasant 16 21} {FACING se}
            {GENERIC_UNIT 4 Peasant 20 22} {FACING se}
            {GENERIC_UNIT 4 Peasant 18 27} {FACING sw}
            {GENERIC_UNIT 4 Peasant 15 26} {FACING sw}
            
            [capture_village]
                side=4
                x,y,radius=17,24,3
            [/capture_village]
        )
        (JUSTCOMPLETED_START=
            {FIRE_EVENT_UNIT moveto id=Konrad}
        )
        (COMPLETED_MOVETO=
            [message]
                role=elensefar_completed_thief
                message= _ "Thanks again for saving our city, Konrad! Good luck in your fight against the dark queen — for all our sakes."
            [/message]
        )
    }
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
