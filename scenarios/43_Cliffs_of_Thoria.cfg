#textdomain wesnoth-h2tt
# scenario by Dalas

#define SCENARIO_TURN_LIMIT
30#enddef
#define TOD_OFFSET
-4#enddef


[scenario]
    name=_"scenario name^Cliffs of Thoria"
    {MAP_DYNAMIC 43_Cliffs_of_Thoria}
    next_scenario,victory_when_enemies_defeated=00_The_Great_Continent,no
    {SCHEDULE_DYNAMIC_DAY OFFSET={TOD_OFFSET}}
    turns={SCENARIO_TURN_LIMIT}
          {SCENARIO_MUSIC "battle.ogg"}
    {EXTRA_SCENARIO_MUSIC "battle-epic.ogg"}
    {EXTRA_SCENARIO_MUSIC "legends_of_the_north.ogg"}

    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    {KONRAD_SIDE FOG=yes}
    
    #############################
    # DRAKES
    #############################
    [side]
        side=2
        no_leader=yes
        controller=ai
        [ai]
            passive_leader=yes
        [/ai]
        team_name=drakes
        user_team_name=_"Drakes"
    [/side]
    [event]
        name=side 2 turn
        first_time_only=no
        {RESET_SIDE_AI 2 offensive 0.4 0.25}
        {VARY_AI_BY_SCHEDULE_ENEMY 2 1,$lisar_side}
        {MODIFY_SIDE_AI $lisar_side ([avoid] 
            x=1-40,14-19,44-55,41-43
            y=15-22,13-14,11-22,14-22
        [/avoid])}
    [/event]
    # serpents
    [side]
        side=3
        no_leader=yes
        controller=ai
        hidden=yes
        [ai]
            aggression=0.9
            [avoid]
                x=1-55,1-44,1-41
                y=1-11,12-13,14-22
            [/avoid]
        [/ai]
        team_name=monsters
        user_team_name=_"Monsters"
    [/side]
    # warven
    [side]
        side=4
        no_leader=yes
        controller=null
        hidden=yes
        team_name=konrad,drakes,monsters
    [/side]

    #############################
    # LISAR
    #############################
    {LISAR_SIDE 5 (RECRUIT=Bowman)}
    {LISAR_CHOOSE_CONTROLLER
        (IF_AI_CONTROL=
            {SILENTLY_LIMIT_LEADER_MOVES $lisar_side 2}
            {LIMIT_CONTEMPORANEOUS_RECRUITS $lisar_side Fencer 3}
        )
    }
    [event]
        name=side $lisar_side turn
        first_time_only=no
        {RESET_SIDE_AI $lisar_side defensive 0.4 0.25}
        {VARY_AI_BY_SCHEDULE_ENEMY_NIGHTTIME $lisar_side 2,3}
        {MODIFY_SIDE_AI $lisar_side ([avoid] 
            x,y=0-15,0-11 # lisar stays out of Konrad's starting corner
        [/avoid])}
    [/event]
    
    #######################################################################################################################################################
    #                                                                    PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart
        {ADD_MULTIHEX_WIND x,y=1-55,1-22 "~FL()"}
        
        #############################
        # WATERFALLS
        #############################
        {PLACE_WATERFALL nw 43 3 "~FL()"}
        {PLACE_WATERFALL n  44 3 ""}
        {PLACE_WATERFALL nw 44 3 "~FL()"}
        {PLACE_WATERFALL n  45 4 ""}
        {PLACE_WATERFALL nw 45 4 "~FL()"}
        {PLACE_WATERFALL se 45 4 ""}
        {PLACE_WATERFALL nw 45 5 "~FL()"}
        {PLACE_WATERFALL n  46 5 ""}
        {PLACE_WATERFALL nw 46 5 "~FL()"}
        {PLACE_WATERFALL n  47 6 ""}
        {PLACE_WATERFALL nw 47 6 "~FL()"}
        {PLACE_WATERFALL se 47 6 ""}
        {PLACE_WATERFALL nw 47 7 "~FL()"}
        
        {PLACE_WATERFALL nw 49 3 "~FL()"}
        {PLACE_WATERFALL n  50 3 ""}
        {PLACE_WATERFALL nw 50 3 "~FL()"}
        {PLACE_WATERFALL se 50 3 ""}
        {PLACE_WATERFALL nw 50 4 "~FL()"}
        {PLACE_WATERFALL se 50 4 ""}
        {PLACE_WATERFALL nw 50 5 "~FL()"}
        {PLACE_WATERFALL n  51 6 ""}
        {PLACE_WATERFALL nw 51 6 "~FL()"}
        
        #############################
        # SHIPWRECKS
        #############################
        {PLACE_IMAGE "scenery/wreck-3.png~FL()" 43  5}
        {PLACE_IMAGE "scenery/wreck-2.png~FL()" 46 13}
        {PLACE_IMAGE "scenery/wreck-2.png"      44 17}
        {PLACE_IMAGE "scenery/wreck.png"        48  6}
        {PLACE_IMAGE "scenery/wreck.png~FL()"   48 19}
        {PLACE_IMAGE "scenery/wreck.png~FL()"   13  3}
        {PLACE_IMAGE "scenery/wreck.png"        39 13}
        {PLACE_IMAGE "scenery/wreck-2.png~FL()" 32  2}
        {PLACE_IMAGE "scenery/wreck-2.png"      33 14}
        {PLACE_IMAGE "scenery/wreck.png"        33 14}
        {PLACE_IMAGE "scenery/wreck.png~FL()"   29 10}
        
        #############################
        # WARVEN
        #############################
        {NAMED_UNIT 4 "Injured Lieutenant" 45 16 Warven _"Warven" ()} {HITPOINTS 1} {EXPERIENCE 27}
        {ADD_MODIFICATION({TRAIT_LOYAL}{TRAIT_FEARLESS})}
        {MODIFY_UNIT id=Warven status.poisoned yes}
        
        #############################
        # KONRAD
        #############################
        {RECALL_KONRAD_AND_COMPANIONS 1 11}
        {TELEPORT_UNIT id=Delfador 3 11}
        {TELEPORT_UNIT x,y=1,9 2 12}
        {UNSTORE_NPC Lisar x,y=1,9 side=$lisar_side}
        {REVEAL x,y,radius=7,10,2}
    [/event]

    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        
        #############################
        # SCOUTING THE BATTLEFIELD
        #############################
        {DELAY 500}
        [message]
            speaker=Konrad
            message= _ "All is quiet. Whatever fight was happening here, it ended before we could intervene."
        [/message]
        {SCROLL_TO 38 18}
        [if] {VARIABLE_CONDITIONAL bm_gave_familiar_to_konrad equals yes} {THEN(
            [message]
                speaker,scroll=Delfador,no
                message= _ "And the outcome is no mystery — there is a small fleet of boats shattered among the river islands! I shall send a scout to investigate."
            [/message]
            {NAMED_NOTRAIT_UNIT 4 "Fire Wraith" 4 11 familiar _"Messenger"} {ANIMATE} {FACING se}
            {MOVE_UNIT id=familiar 15 11}
            {DELAY 3000}
            {MOVE_UNIT id=familiar 4 11}
            [message]
                speaker=familiar
                message=_"Fsss... crackle crackle hiss!"
            [/message]
        )} {ELSE(
            [message]
                speaker,scroll=Delfador,no
                message= _ "And the outcome is no mystery — there is a small fleet of boats shattered among the river islands! I shall send my familiar to investigate."
            [/message]
            {NAMED_NOTRAIT_UNIT 4 "War Harbinger" 4 11 familiar _"Familiar"} {ANIMATE} {FACING se}
            {ADD_MODIFICATION( {TRAIT_LOYAL} {TRAIT_AGED} )}
            {MOVE_UNIT id=familiar 15 11}
            {DELAY 3000}
            {MOVE_UNIT id=familiar 4 11}
            [message]
                speaker=familiar
                message=_"Kraa! Kraa! Kraa!"
            [/message]
        )} [/if]
        {KILL id=familiar}
        
        [message]
            speaker=Delfador
            message= _ "Curious. The wrecks are not of proper ships, but of shallow-draft rafts built only recently; much of their timber is green. Those that were not capsized have been burned. And most curious of all — all flew the banner of Wesnoth."
        [/message]
        [message]
            speaker=Lisar {LISAR_VARIATION glad}
            message= _ "Wesnoth! There is only one army of Wesnoth in these lands, and it is the one which I led here to fight you. These must be survivors from the volcano!"
        [/message]
        [message]
            speaker=Konrad
            message= _ "I’m afraid they don’t seem to be survivors any longer, Li’sar."
        [/message]
        [message]
            speaker=Lisar
            message= _ "The men I trained are skilled and tenacious. If it was possible to survive, they will have. We shall ready our forces to search the river."
        [/message]
        {DELAY 500}
        
        #############################
        # KEH OHN ARRIVES
        #############################
        {SOUND drake-hit-2.ogg}
        {NAMED_UNIT 2 "Armageddon Drake" 28 9 "Keh Ohn" _"Keh Ohn" ()} {LEADER} {GUARDIAN}
        {GIVE_OBJECT_TO id="Keh Ohn" ({EFFECT overlay add=misc/hero-icon.png})}
        {MOVE_UNIT id="Keh Ohn" 6 9}
        {DELAY 500}
        {ANIMATE_ATTACK id="Keh Ohn" range=ranged yes x,y=5,10}
        {ANIMATE_ATTACK id="Keh Ohn" range=ranged yes x,y=5,10}
        [message]
            speaker=Keh Ohn
            message= _ "[Keh Ohn introduces himself]"
        [/message]
        [message]
            speaker=Konrad
            message= _ "A drake! So the winged figures we saw fighting were drakes. You are the ones who destroyed this flotilla?"
        [/message]
        [message]
            speaker=Keh Ohn
            message= _ "[Keh Ohn confirms that they were, and he threatens Konrad/Lisar]"
        [/message]
        [message]
            speaker=Konrad
            message= _ "We are not here to fight you, but we do wish to search the river for survivors. There need be no further battle between man and drake."
        [/message]
        [message]
            speaker=Keh Ohn
            message= _ "[Keh Ohn takes Konrad's request as confirmation that Konrad/Lisar are in league with the attackers]"
        [/message]
        [message]
            speaker=Keh Ohn
            message= _ "[Keh Ohn calls his drakes to arms, to fight Konrad and Lisar]"
        [/message]
        {MOVE_UNIT id="Keh Ohn" 28 9}
        {MODIFY_UNIT id="Keh Ohn" facing sw}
        
        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                description= _ "Find the survivor near the southeast corner of the map."
                condition=win
                [show_if]
                    {HAVE_UNIT id,side=Warven,4}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Then, escort him back to your starting encampment."
                condition=win
                [show_if]
                    {HAVE_UNIT id,side=Warven,4}
                [/show_if]
            [/objective]
            
            [objective]
                description= _ "Escort Warven back to your starting encampment."
                condition=win
                [show_if]
                    {HAVE_UNIT id,side=Warven,1}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Death of Warven."
                condition=lose
                [show_if]
                    {HAVE_UNIT id,side=Warven,1}
                [/show_if]
            [/objective]
            
            {OBJECTIVES_HERODEATHS}
            {TURNS_RUN_OUT}
            [gold_carryover]
                carryover_percentage,bonus=40,yes
            [/gold_carryover]
        [/objectives]
    [/event]
    
    
    
    
# 
#     [event]
#         name=prestart
#         [store_locations]
#             terrain=*^V*    # wmllint: ignore
#             [and]
#                 x=14
#                 y=9
#                 radius=10
#             [/and]
#             variable=temp_starting_villages_area
#         [/store_locations]
# 
#         [foreach]
#             array=temp_starting_villages_area
#             [do]
#                 [capture_village]
#                     side=2
#                     x,y=$this_item.x,$this_item.y
#                 [/capture_village]
#             [/do]
#         [/foreach]
# 
#         {CLEAR_VARIABLE temp_starting_villages_area}
#     [/event]
# 
#     [event]
#         name=prestart
#         [store_locations]
#             terrain=*^V*    # wmllint: ignore
#             [and]
#                 x=34
#                 y=7
#                 radius=10
#             [/and]
#             variable=temp_starting_villages_area
#         [/store_locations]
# 
#         [foreach]
#             array=temp_starting_villages_area
#             [do]
#                 [capture_village]
#                     side=2
#                     x,y=$this_item.x,$this_item.y
#                 [/capture_village]
#             [/do]
#         [/foreach]
# 
#         {CLEAR_VARIABLE temp_starting_villages_area}
#     [/event]
# 
#     [event]
#         name=prestart
# 
#         [set_variables]
#             name=drake_bases
# 
#             [value]
#                 x,y=12,10
#             [/value]
#             [value]
#                 x,y=16,6
#             [/value]
#             [value]
#                 x,y=22,7
#             [/value]
#             [value]
#                 x,y=23,13
#             [/value]
#             [value]
#                 x,y=28,9
#             [/value]
#             [value]
#                 x,y=31,5
#             [/value]
#             [value]
#                 x,y=34,12
#             [/value]
#             [value]
#                 x,y=41,12
#             [/value]
#         [/set_variables]
# 
#         [set_variables]
#             name=drake_bases_melee
# 
#             [value]
#                 x,y=38,8
#             [/value]
#             [value]
#                 x,y=39,4
#             [/value]
#         [/set_variables]
#     [/event]
# 
#     [event]
#         name=moveto
#         first_time_only=no
# 
#         [filter]
#             side=1
# 
#             [filter_location]
#                 find_in=drake_bases
#                 [or]
#                     find_in=drake_bases_melee
#                 [/or]
#             [/filter_location]
#         [/filter]
# 
#         {RANDOM 10..50}
# 
#         [gold]
#             side=1
#             amount=+$random
#         [/gold]
# 
#         [message]
#             speaker=unit
#             message= _ "We’ve found $random gold in the drake nest."
#             image=items/gold-coins-medium.png
#         [/message]
#         {CLEAR_VARIABLE random}
# 
#         # Remove the current location from the array
#         [for]
#             array=drake_bases
#             [do]
#                 [if]
#                     [variable]
#                         name=drake_bases[$i].x
#                         numerical_equals=$x1
#                     [/variable]
# 
#                     [variable]
#                         name=drake_bases[$i].y
#                         numerical_equals=$y1
#                     [/variable]
# 
#                     [then]
#                         {CLEAR_VARIABLE drake_bases[$i]}
# 
#                         [break][/break]
#                     [/then]
#                 [/if]
#             [/do]
#         [/for]
# 
#         [for]
#             array=drake_bases_melee
#             [do]
#                 [if]
#                     [variable]
#                         name=drake_bases_melee[$i].x
#                         numerical_equals=$x1
#                     [/variable]
# 
#                     [variable]
#                         name=drake_bases_melee[$i].y
#                         numerical_equals=$y1
#                     [/variable]
# 
#                     [then]
#                         {CLEAR_VARIABLE drake_bases_melee[$i]}
# 
#                         [break][/break]
#                     [/then]
#                 [/if]
#             [/do]
#         [/for]
#         {CLEAR_VARIABLE i}
#     [/event]
# 
#     [event]
#         name=last breath
#         [filter]
#             id=Keh Ohn
#         [/filter]
#         [message]
#             speaker=Keh Ohn
#             message= _ "GRRROOOOAAAAR!"  # wmllint: no spellcheck
#         [/message]
#         [message]
#             speaker=second_unit
#             message= _ "Hurrah! We’ve killed their leader!"
#         [/message]
#         [message]
#             side=2
#             canrecruit=no
#             message= _ "Our leader is dead, but it matters not! Time enough to appoint a new leader after the battle is won! Fight on to the last, comrades!"
#         [/message]
#         [message]
#             speaker=Konrad
#             {KONRAD_VARIATION mad}
#             message= _ "Keep on going down the river. While we’re at it, let us force as many drakes as possible to pay with their lives. They defy us, and now they will meet the same fate as their leader!"
#         [/message]
#         [message]
#             side=1
#             [and]
#                 race=elf
#                 level=1
# 
#                 [or]
#                     race=elf
#                     level=2
#                 [/or]
# 
#                 [or]
#                     race=merman
#                 [/or]
#             [/and]
#             message= _ "We hear and obey, My Lord."
#         [/message]
#     [/event]
# 
#     # Each turn, a drake will be spawned from each base which still stands;
#     # however, a lvl2 drake will take 2 turns to appear and a lvl3 drake 3 turns
#     [event]
#         name=new turn
#         first_time_only=no
# 
#         [foreach]
#             array=drake_bases
#             [do]
#                 [if]
#                     # We only attempt to spawn drakes from a base if there isn't one
#                     # already standing there
#                     [not]
#                         [have_unit]
#                             x,y=$this_item.x,$this_item.y
#                         [/have_unit]
#                     [/not]
# 
#                     [then]
#                         [switch]
#                             variable=this_item.delayed_spawning_on_turn
# 
#                             # For spawning level 2~3 units
#                             [case]
#                                 value="$($turn_number + 0)"
# 
#                                 {GENERIC_UNIT 2 $this_item.spawn_type $this_item.x $this_item.y}
#                                 [+unit]
#                                     ai_special=guardian
#                                     facing=sw
#                                 [/unit]
#                                 {CLEAR_VARIABLE this_item.delayed_spawning_on_turn}
#                                 {CLEAR_VARIABLE this_item.spawn_type}
#                             [/case]
# 
#                             # For doing nothing for 1 turn when level 3 was chosen on the previous turn
#                             [case]
#                                 value="$($turn_number + 1)"
#                             [/case]
# 
#                             [else]
# #ifdef EASY
#                                 {VARIABLE_OP spawn_level rand "1,2"}
# #else
#                                 {VARIABLE_OP spawn_level rand "1,1,2,2,3"}
# #endif
# 
#                                 [switch]
#                                     variable=spawn_level
# 
#                                     # For choosing and spawning level 1 units
#                                     [case]
#                                         value=1
# 
#                                         {VARIABLE_OP spawn_type rand "Drake Fighter,Drake Burner,Drake Glider"}
# 
#                                         {GENERIC_UNIT 2 $spawn_type $this_item.x $this_item.y}
#                                         [+unit]
#                                             ai_special=guardian
#                                             facing=sw
#                                         [/unit]
#                                         {CLEAR_VARIABLE spawn_type}
#                                     [/case]
# 
#                                     # For choosing level 2 units
#                                     [case]
#                                         value=2
# 
#                                         {VARIABLE_OP this_item.spawn_type rand "Drake Warrior,Drake Flare,Fire Drake,Sky Drake"}
# 
#                                         {VARIABLE this_item.delayed_spawning_on_turn "$($turn_number + 1)"}
#                                     [/case]
# 
#                                     # For choosing level 3 units
#                                     [case]
#                                         value=3
# 
#                                         {VARIABLE_OP this_item.spawn_type rand "Drake Blademaster,Drake Flameheart,Inferno Drake,Hurricane Drake"}
# 
#                                         {VARIABLE this_item.delayed_spawning_on_turn "$($turn_number + 2)"}
#                                     [/case]
#                                 [/switch]
#                                 {CLEAR_VARIABLE spawn_level}
#                             [/else]
#                         [/switch]
#                     [/then]
#                 [/if]
#             [/do]
#         [/foreach]
# 
#         [foreach]
#             array=drake_bases_melee
#             [do]
#                 [if]
#                     # We only attempt to spawn drakes from a base if there isn't one
#                     # already standing there
#                     [not]
#                         [have_unit]
#                             x,y=$this_item.x,$this_item.y
#                         [/have_unit]
#                     [/not]
# 
#                     [then]
#                         [switch]
#                             variable=this_item.delayed_spawning_on_turn
# 
#                             # For spawning level 2~3 units
#                             [case]
#                                 value="$($turn_number + 0)"
# 
#                                 {GENERIC_UNIT 2 $this_item.spawn_type $this_item.x $this_item.y}
#                                 [+unit]
#                                     ai_special=guardian
#                                     facing=sw
#                                 [/unit]
#                                 {CLEAR_VARIABLE this_item.delayed_spawning_on_turn}
#                                 {CLEAR_VARIABLE this_item.spawn_type}
#                             [/case]
# 
#                             # For doing nothing for 1 turn when level 3 was chosen on the previous turn
#                             [case]
#                                 value="$($turn_number + 1)"
#                             [/case]
# 
#                             [else]
# #ifdef EASY
#                                 {VARIABLE_OP spawn_level rand "1,2"}
# #else
#                                 {VARIABLE_OP spawn_level rand "1,1,2,2,3"}
# #endif
# 
#                                 [switch]
#                                     variable=spawn_level
# 
#                                     # For choosing and spawning level 1 units
#                                     [case]
#                                         value=1
# 
#                                         {VARIABLE_OP spawn_type rand "Drake Clasher"}
# 
#                                         {GENERIC_UNIT 2 $spawn_type $this_item.x $this_item.y}
#                                         [+unit]
#                                             ai_special=guardian
#                                             facing=sw
#                                         [/unit]
#                                         {CLEAR_VARIABLE spawn_type}
#                                     [/case]
# 
#                                     # For choosing level 2 units
#                                     [case]
#                                         value=2
# 
#                                         {VARIABLE_OP this_item.spawn_type rand "Drake Thrasher,Drake Arbiter"}
# 
#                                         {VARIABLE this_item.delayed_spawning_on_turn "$($turn_number + 1)"}
#                                     [/case]
# 
#                                     # For choosing level 3 units
#                                     [case]
#                                         value=3
# 
#                                         {VARIABLE_OP this_item.spawn_type rand "Drake Enforcer,Drake Warden"}
# 
#                                         {VARIABLE this_item.delayed_spawning_on_turn "$($turn_number + 2)"}
#                                     [/case]
#                                 [/switch]
#                                 {CLEAR_VARIABLE spawn_level}
#                             [/else]
#                         [/switch]
#                     [/then]
#                 [/if]
#             [/do]
#         [/foreach]
#     [/event]
# 
#     [event]
#         name=moveto
#         [filter]
#             side=1
#         [/filter]
#         [filter_condition]
#             [have_location]
#                 x,y=$x1,$y1
#                 [and]
#                     x,y=45,16
#                     radius=7
#                 [/and]
#             [/have_location]
#         [/filter_condition]
#         [modify_side]
#             side=4
#             share_vision=all
#         [/modify_side]
#         [message]
#             speaker=unit
#             message= _ "I see someone at the top of the furthermost cliff!"
#         [/message]
#         [lift_fog]
#             [filter_side]
#                 side=1
#             [/filter_side]
#             x,y=45,16
#             radius=2
#         [/lift_fog]
#         [scroll_to]
#             x=45
#             y=16
#         [/scroll_to]
#         [message]
#             speaker=unit
#             scroll=no
#             message= _ "It is a young human officer, barely more than a boy. He appears badly hurt but still alive."
#         [/message]
#         [message]
#             speaker=unit
#             scroll=no
#             message= _ "I wonder why the drakes haven’t finished him by now? It is strange that there are not any drakes in that area."
#         [/message]
# #define SERPENT X Y
#     [unit]
#         type=Water Serpent
#         side=3
#         x={X}
#         y={Y}
#         [movement_costs]
#             mountains={UNREACHABLE}
#         [/movement_costs]
#     [/unit]
# #enddef
#         {SERPENT 48 13}
#         {SERPENT 45 12}
#         {SERPENT 50 16}
#         {SERPENT 48 18}
#         {SERPENT 45 19}
# #undef SERPENT
#         [message]
#             type=Water Serpent
#             scroll=no
#             message= _ "Grrroar"    # wmllint: no spellcheck
#         [/message]
#         [scroll_to_unit]
#             id=unit
#         [/scroll_to_unit]
#         [message]
#             speaker=unit
#             scroll=no
#             message= _ "Well... that answers the question."
#         [/message]
#         [message]
#             speaker="Li'sar"
#             message= _ "We should try to help the injured soldier."
#         [/message]
#         [message]
#             speaker=Konrad
#             message= _ "Must I remind you that he, like all the others who died, was sent to kill us!?"
#         [/message]
#         [message]
#             speaker="Li'sar"
#             message= _ "Perhaps he was sent after you, but not after me. I am sure that he is still loyal to his princess — the heiress to the throne of Wesnoth!"
#         [/message]
#         [message]
#             speaker=Delfador
#             message= _ "Li’sar, do I have to remind you again that it is Konrad, not you, who is the rightful heir?"
#         [/message]
#         [message]
#             speaker="Li'sar"
#             message= _ "Be that as it may, I still think we should make an effort to rescue him from the unfortunate position he is in. If you help him, I’ll do my best to convince him that you are not his enemies but his friends."
#         [/message]
#         [message]
#             speaker=Kalenz
#             message= _ "Very well. If you convince him not to raise his sword against us, the Lintanir elves shall grant him safe passage."
#         [/message]
#         [message]
#             speaker=Konrad
#             message= _ "Our main goal remains to survive ourselves, but if we can spare the troops, we might try to rescue the officer stranded on the cliff. However, I make no promises."
#         [/message]
#         [message]
#             speaker="Li'sar"
#             message= _ "That I do understand, Konrad. I am no stranger to the burden of command."
#         [/message]
#         {IF_VAR waterfall_sighted boolean_equals yes (
#             [then]
#                 [message]
#                     speaker=Konrad
#                     message= _ "I’m glad we agree, Li’sar. Now, onward! We must reach the cave."
#                 [/message]
#             [/then]
#             [else]
#                 [message]
#                     speaker=Konrad
#                     message= _ "I’m glad we agree, Li’sar. Now, onward! We must continue downstream, past these drakes."
#                 [/message]
#             [/else]
#         )}
#         {VARIABLE lieutenant_sighted yes}
#         [show_objectives][/show_objectives]
#     [/event]
# 
#     [event]
#         name=moveto
#         [filter]
#             side=1
#             x=44,44,45,45,46,46
#             y=15,16,15,17,15,16
#         [/filter]
# 
#         [kill]
#             id=Warven
#         [/kill]
# 
#         [unit]
#             type=Lieutenant
#             side=1
#             x=45
#             y=16
#             id=Warven
#             name= _ "Warven"
#             hitpoints=1
#             experience=27
#             [modifications]
#                 {TRAIT_LOYAL}
#                 {TRAIT_FEARLESS}
#             [/modifications]
#             [status]
#                 poisoned=yes
#             [/status]
#         [/unit]
# 
#         [message]
#             speaker=Warven
#             message= _ "Who...who are you? A friend or a foe?"
#         [/message]
#         [message]
#             speaker=unit
#             message= _ "We are friends. Don’t worry about it and don’t try to fight us — you are in no condition to fight."
#         [/message]
#         [message]
#             speaker="Li'sar"
#             message= _ "I am the Princess, Li’sar, and we are friends. Join us and wait for the healers to help you, young lieutenant."
#         [/message]
#         [message]
#             speaker=Warven
#             message= _ "Princess Li’sar — here? Your Highness, I am yours to command!"
#         [/message]
#         [message]
#             speaker=Konrad
#             message= _ "Follow us when you think you are capable and beware of monsters. We have fought many already, and there are sure to be more ahead."
#         [/message]
#         {VARIABLE lieutenant_sighted no}
#     [/event]
# 
#     [event]
#         name=moveto
#         [filter]
#             x=53-55
#             y=1-5
#             side=1
#         [/filter]
# 
#         {VARIABLE waterfall_sighted yes}
# 
#         [message]
#             speaker=unit
#             message= _ "There is a cataract ahead. By the thunder of the water and the height of the spume, it must drop several hundred feet at least. We must leave the river before we are swept into it, or we will surely perish!"
#         [/message]
# 
#         {REMOVE_IMAGE 55 3}
# 
#         {WATERFALL_MASK 55 3}
# 
#         [role]
#             role=merman-advisor
#             reassign=no
#             search_recall_list=no
#             type="Merman Triton,Merman Hoplite,Merman Javelineer,Merman Entangler,Mermaid Diviner,Mermaid Siren," +
#                 "Merman Warrior,Merman Spearman,Merman Netcaster,Mermaid Priestess,Mermaid Enchantress," +
#                 "Merman Fighter,Merman Hunter,Mermaid Initiate"
#         [/role]
#         [message]
#             role=merman-advisor
#             message= _ "Even we merfolk cannot swim that. The road east is blocked."
#         [/message]
#         [message]
#             speaker=Konrad
#             message= _ "Wait. What about the tributary which flows into the river from inside the mountain? There seems to be a cave..."
#         [/message]
#         [message]
#             speaker=Kalenz
#             # wmllint: local spelling Everlore
#             message= _ "Legend says that that little river comes from the land of the North Elves. It is said that it is an outflow of Everlore, which flows in the land of my home and that there is a cave system in that area with several cave entrances and springs which flow into the ground. I can say no more about it, except that it is swarming with undead and other creatures which find power in the darkness of the caves. We elves prefer not to venture into the caves; instead we put guards near the entrances to kill any foul creature foolish enough to wander outside. No elves have been inside for centuries and that area is unknown to us. Truly, I don’t recommend entering the cave if we have any other options."
#         [/message]
#         [message]
#             speaker=Konrad
#             message= _ "Unfortunately, we have no other options. Onward into the cave!"
#         [/message]
# 
#         [show_objectives][/show_objectives]
# 
#         {PLACE_IMAGE items/gohere.png 37 1}
# 
#         [event]
#             name=moveto
#             [filter]
#                 x=37
#                 y=1
#                 id=Konrad
#             [/filter]
#             [message]
#                 speaker=Konrad
#                 message= _ "I’ve reached the cave entrance. There seems to be a system of channels running through the mountains. Follow me, and let us hope we somehow manage to get out alive."
#             [/message]
#             [message]
#                 speaker="Li'sar"
#                 message= _ "That is so very encouraging..."
#             [/message]
#             [message]
#                 speaker=Delfador
#                 message= _ "I wonder what kind of monsters await us inside."
#             [/message]
#             [message]
#                 speaker=Kalenz
#                 message= _ "We are soon going to find out."
#             [/message]
#             [message]
#                 speaker="Li'sar"
#                 message= _ "Well, there is no point in delaying any further. Let us go and find out."
#             [/message]
#             [message]
#                 speaker=Warven
#                 side=1
#                 message= _ "Yes, my lady!"
#             [/message]
#             [message]
#                 speaker=Konrad
#                 message= _ "Everybody inside..."
#             [/message]
#             [endlevel]
#                 result=victory
#                 bonus=yes
#                 {NEW_GOLD_CARRYOVER 40}
#             [/endlevel]
#         [/event]
#     [/event]
# 
#     [event]
#         name=victory
# 
#         {CLEAR_VARIABLE lieutenant_sighted,waterfall_sighted,drake_bases}
#     [/event]
[/scenario]
